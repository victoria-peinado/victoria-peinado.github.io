import{r as u,b as h,d as b,e as j,s as P,q as E,f as v,h as N,w as C,i as w,u as S,j as e,C as A,k,l as I,B as g}from"./index-Di-Zw_TF.js";import{L as U}from"./Label-B4QQdoiM.js";import{I as B}from"./Input-BKMhVuRP.js";function F(){const[t,s]=u.useState(""),[p,n]=u.useState(""),[i,a]=u.useState(!1),d=h(),{gamePin:o}=b(),{currentUser:r,loading:m}=j();return u.useEffect(()=>{(async()=>{if(!m&&!r)try{await P()}catch(l){console.error("Failed to sign in anonymously on join page:",l),n("Could not initialize guest session. Please refresh.")}})()},[m,r]),u.useEffect(()=>{if(o)s(o.toUpperCase());else{const c=sessionStorage.getItem("gamePin");c&&s(c.toUpperCase())}},[o]),{pin:t,setPin:s,error:p,isJoining:i||(!r||m),handleSubmit:async c=>{if(c.preventDefault(),!!t.trim()){if(m||!r){n("Guest authentication is not complete. Please wait a moment and try again."),a(!1);return}a(!0),n("");try{const l=t.trim().toUpperCase(),f=E(v(N,"gameSessions"),C("gamePinUpper","==",l)),y=await w(f);if(y.empty){n("Game not found. Please check the PIN and try again."),a(!1);return}sessionStorage.removeItem("gamePin");const x=y.docs[0].id;d(`/player/${x}`)}catch(l){console.error("Error finding game:",l),n("An error occurred. Please try again."),a(!1)}}}}}function D(){const{t}=S(),{pin:s,setPin:p,error:n,isJoining:i,handleSubmit:a}=F(),d=h(),o=()=>{d("/")};return e.jsxs("div",{className:"container mx-auto flex flex-col items-center justify-center py-12",children:[e.jsx(A,{className:"w-full max-w-md",children:e.jsxs(k,{className:"p-8",children:[e.jsx(I,{className:"text-center mb-2",children:t("pinEntry.title")}),e.jsx("p",{className:"text-center text-neutral-200 mb-6",children:t("pinEntry.subtitle")}),e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"pin",className:"sr-only",children:t("pinEntry.label")}),e.jsx(B,{type:"text",id:"pin",value:s,onChange:r=>p(r.target.value.toUpperCase()),placeholder:t("pinEntry.placeholder"),maxLength:5,className:"text-2xl text-center uppercase font-display tracking-widest",disabled:i})]}),n&&e.jsx("div",{className:"bg-secondary text-white px-4 py-3 rounded text-center",children:n}),e.jsx(g,{type:"submit",variant:"primary",disabled:i||s.trim().length===0,className:"w-full",children:t(i?"pinEntry.buttonLoading":"pinEntry.button")})]})]})}),e.jsx(g,{onClick:o,variant:"link",className:"mt-4",children:t("pinEntry.backToHome","Back to Home")})]})}export{D as default};
