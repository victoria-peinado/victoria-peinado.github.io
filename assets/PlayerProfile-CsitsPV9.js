import{j as e,e as v,r as l,Z as A,_ as S,$ as L,L as D,C as p,B as T}from"./index-Di-Zw_TF.js";function E(){return e.jsx("div",{className:"flex justify-center items-center py-4",children:e.jsx("div",{className:"w-10 h-10 border-4 border-primary border-t-transparent border-solid rounded-full animate-spin",role:"status","aria-label":"loading"})})}const P=20,U=()=>{const{currentUser:t}=v(),[i,d]=l.useState(null),[j,h]=l.useState(!0),[a,N]=l.useState([]),[f,u]=l.useState(!1),[c,y]=l.useState(null),[s,x]=l.useState(!0),[m,C]=l.useState(!1);l.useEffect(()=>{console.log("--- useUserProfile DEBUG ---"),t?.uid?(console.log(`[1] Auth context is ready. Fetching profile for UID: ${t.uid}`),(async()=>{h(!0);try{const o=await S(t.uid);if(o)console.log("[2] SUCCESS: Profile data found!",o),d(o);else{console.log("[2] Profile data NOT found. Calling createProfile...");const w=t.email.split("@")[0];await L(t.uid,t.email,w),console.log("[3] Profile created. Refetching data...");const g=await S(t.uid);g?(console.log("[4] SUCCESS: Newly created profile data found!",g),d(g)):console.error("[4] FAILURE: Still no profile data after create. This is bad.")}}catch(o){console.error("[!] ERROR during fetchProfile:",o)}finally{console.log("[5] Setting loadingProfile to false."),h(!1)}})()):console.log("[1] currentUser or currentUser.uid is missing. Waiting for auth...")},[t]);const M=l.useCallback(async()=>{if(f||!t?.uid||!s){s||console.log("[Matches] No more matches to fetch.");return}if(a.length>=P){x(!1);return}console.log("[Matches] Fetching more matches..."),u(!0);try{const{matches:n,lastDoc:o}=await A(t.uid,10,c);console.log(`[Matches] Found ${n.length} new matches.`),N(w=>[...w,...n].slice(0,P)),y(o),(n.length<10||!o||a.length+n.length>=P)&&(console.log("[Matches] No more matches to load."),x(!1))}catch(n){console.error("[Matches] Error fetching match history:",n)}finally{u(!1)}},[t?.uid,c,f,a.length,s]);l.useEffect(()=>{i&&!m&&(console.log("[Matches] Profile loaded. Fetching initial match history."),C(!0),M())},[i,m,M]);const r=i?.stats||{},b=r.totalQuestionsCorrect>0?(r.totalAnswerTimeMs/r.totalQuestionsCorrect/1e3).toFixed(2):0;return r.totalQuestionsAnswered>0&&(r.totalQuestionsCorrect/r.totalQuestionsAnswered*100).toFixed(0),{profile:i,loadingProfile:j,stats:r,lifetimeAvgAnswerTime:b,matches:a,loadingMatches:f,hasMore:s,fetchMoreMatches:M,totalMatchesToShow:a.length}};console.log("--- PlayerProfile.jsx Component Rendered ---");function R(){const{profile:t,loadingProfile:i,stats:d,lifetimeAvgAnswerTime:j,matches:h,loadingMatches:a,hasMore:N,fetchMoreMatches:f,totalMatchesToShow:u}=U();if(i)return e.jsx(D,{text:"Loading Profile..."});if(!t)return e.jsx("div",{className:"text-center p-8 text-neutral-300",children:"Could not load user profile."});const c=({title:s,value:x,unit:m})=>e.jsxs(p,{className:"p-6 text-center bg-neutral-800",children:[e.jsx("p",{className:"text-sm font-medium text-neutral-400 uppercase tracking-wider",children:s}),e.jsxs("p",{className:"text-4xl font-bold font-display text-primary",children:[x,m&&e.jsx("span",{className:"text-lg text-neutral-300 ml-1",children:m})]})]}),y=({match:s})=>e.jsxs(p,{className:"p-4 bg-neutral-800 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:s.gameName}),e.jsx("p",{className:"text-sm text-neutral-400",children:s.gameDate})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:["Rank ",s.finalRank]}),e.jsxs("p",{className:"text-neutral-300",children:[s.finalScore," Points"]}),e.jsxs("p",{className:"text-neutral-400 text-sm",children:[s.questionsCorrect," Correct"]})]})]});return e.jsxs("div",{className:"max-w-4xl mx-auto p-4 md:p-8",children:[e.jsx("h1",{className:"text-4xl font-display font-bold text-white mb-2",children:t.displayName}),e.jsx("p",{className:"text-lg text-neutral-400 mb-8",children:t.email}),e.jsxs(p,{className:"p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-display text-white mb-4",children:"Lifetime Stats"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(c,{title:"Games Played",value:d.gamesPlayed||0}),e.jsx(c,{title:"Total Correct",value:d.totalQuestionsCorrect||0,unit:"Answers"}),e.jsx(c,{title:"Avg. Answer Time",value:j,unit:"sec"})]})]}),e.jsxs(p,{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-display text-white mb-4",children:"Match History"}),e.jsxs("div",{className:"space-y-4",children:[h.length===0&&!a&&e.jsx("p",{className:"text-neutral-400 text-center py-4",children:"No matches played yet. Go join a game!"}),h.map(s=>e.jsx(y,{match:s},s.gameId)),a&&e.jsx(E,{}),N&&u<20&&e.jsx(T,{onClick:f,disabled:a,variant:"primary",className:"w-full",children:a?"Loading...":"Load More (10)"}),u>=20&&e.jsx("p",{className:"text-neutral-400 text-center text-sm pt-4",children:"Showing the 20 most recent matches."})]})]})]})}export{R as default};
