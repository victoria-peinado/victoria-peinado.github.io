import{r as l,f as v,h as S,i as q,e as L,u as Q,j as e,y as D,B as j,C as N,k as C,l as g}from"./index-Di-Zw_TF.js";import{g as T,d as A,c as E}from"./bankManagement-zhANBKmn.js";import{C as M}from"./ConfirmModal-BQmpQ8Rz.js";import{I as O}from"./Input-BKMhVuRP.js";import{L as P}from"./Label-B4QQdoiM.js";function R({currentUser:s,handleMessage:t}){const[m,n]=l.useState([]),[c,u]=l.useState(!0),[a,d]=l.useState({}),[k,x]=l.useState(!1),[r,f]=l.useState(null),b=l.useCallback(async()=>{if(s)try{u(!0);const i=await T(s.uid);n(i);const h={};for(const p of i){const B=v(S,`questionBanks/${p.id}/questions`),y=await q(B);h[p.id]=y.size}d(h)}catch{t("Error loading question banks","error")}finally{u(!1)}},[s,t]);l.useEffect(()=>{b()},[b]);const o=l.useCallback(async()=>{const i={},h=await T(s.uid);n(h);for(const p of h){const B=v(S,`questionBanks/${p.id}/questions`),y=await q(B);i[p.id]=y.size}d(i)},[s,t]),I=i=>{f(i),x(!0)},w=()=>{f(null),x(!1)};return{banks:m,loading:c,questionCounts:a,isModalOpen:k,bankToDelete:r,fetchBanks:b,handleUploadSuccess:o,openDeleteModal:I,closeDeleteModal:w,handleDeleteConfirm:async()=>{if(r)try{await A(r.id),t("Bank successfully deleted","success"),n(m.filter(h=>h.id!==r.id));const i={...a};delete i[r.id],d(i)}catch(i){t(i.message,"error")}finally{w()}},setBanks:n,setQuestionCounts:d}}function $({currentUser:s,handleMessage:t,onBankCreated:m}){const[n,c]=l.useState(""),[u,a]=l.useState(!1);return{newBankName:n,setNewBankName:c,isCreating:u,handleCreateBank:async k=>{if(k.preventDefault(),!n.trim()){t("Please enter a bank name","error");return}a(!0);try{const x=await E(s.uid,n);t("Question bank created!","success"),m({id:x,name:n,ownerId:s.uid}),c("")}catch(x){t(x.message,"error")}finally{a(!1)}}}}function z(){const{currentUser:s}=L(),[t,m]=l.useState({text:"",type:""}),[n,c]=l.useState(null),u=l.useCallback((r,f,b=3e3)=>{m({text:r,type:f}),setTimeout(()=>m({text:"",type:""}),b)},[]),a=R({currentUser:s,handleMessage:u}),k=$({currentUser:s,handleMessage:u,onBankCreated:r=>{a.setBanks([...a.banks,r]),a.setQuestionCounts({...a.questionCounts,[r.id]:0})}});return{...a,...k,message:t,selectedBankId:n,setSelectedBankId:c,handleUploadSuccess:async()=>{await a.handleUploadSuccess(),c(null)}}}function U(){const{t:s}=Q(),{newBankName:t,setNewBankName:m,message:n,banks:c,loading:u,isModalOpen:a,bankToDelete:d,questionCounts:k,handleCreateBank:x,openDeleteModal:r,closeDeleteModal:f,handleDeleteConfirm:b}=z();return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-display font-bold",children:s("admin.banks.title")}),e.jsx("p",{className:"text-neutral-300 mt-2",children:s("admin.banks.subtitle")})]}),e.jsx(D,{to:"/admin",children:e.jsx(j,{variant:"secondary",children:s("admin.banks.backButton")})})]}),n.text&&e.jsx("div",{className:`mb-4 p-4 rounded ${n.type==="error"?"bg-secondary":"bg-primary-dark text-white"}`,children:n.text}),e.jsx(N,{className:"mb-8",children:e.jsxs(C,{className:"p-6",children:[e.jsx(g,{className:"mb-4",children:s("admin.banks.createTitle")}),e.jsxs("form",{onSubmit:x,className:"flex flex-col sm:flex-row gap-4 sm:items-end",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(P,{htmlFor:"bankName",children:s("admin.banks.nameLabel")}),e.jsx(O,{type:"text",id:"bankName",value:t,onChange:o=>m(o.target.value),placeholder:s("admin.banks.namePlaceholder"),required:!0})]}),e.jsx(j,{type:"submit",variant:"primary",className:"sm:w-auto whitespace-nowrap",children:s("admin.banks.createButton")})]})]})}),e.jsx(N,{className:"mb-8 bg-neutral-800 border-primary",children:e.jsxs(C,{className:"p-6",children:[e.jsx(g,{className:"mb-4 text-primary-light",children:s("admin.banks.csv.title")}),e.jsx("p",{className:"text-neutral-300 mb-4",children:s("admin.banks.csv.subtitle")}),e.jsx("div",{className:"bg-neutral-900 p-4 rounded mb-4 font-mono text-sm text-neutral-100",children:e.jsx("code",{children:"question;answerA;answerB;answerC;answerD;correctLetter;duration"})}),e.jsxs("ul",{className:"space-y-2 text-neutral-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:s("admin.banks.csv.rule1.key")})," ",s("admin.banks.csv.rule1.text")]}),e.jsxs("li",{children:[e.jsx("strong",{children:s("admin.banks.csv.rule2.key")})," ",s("admin.banks.csv.rule2.text")]})]})]})}),e.jsx(N,{children:e.jsxs(C,{className:"p-6",children:[e.jsx(g,{className:"mb-4",children:s("admin.banks.yourBanks")}),u?e.jsx("p",{children:s("admin.banks.loading")}):c.length===0?e.jsx("p",{className:"text-neutral-300 text-center py-4",children:s("admin.banks.noBanks")}):e.jsx("div",{className:"space-y-4",children:c.map(o=>e.jsxs("div",{className:"border-b border-neutral-700 p-4 flex justify-between items-center hover:bg-neutral-800",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-lg text-neutral-100",children:o.name||o.title||s("admin.banks.untitled")}),e.jsxs("p",{className:"text-sm text-neutral-300",children:[s("admin.banks.questionsPRefix"),":"," ",k[o.id]||0]}),e.jsxs("p",{className:"text-xs text-neutral-500",children:[s("admin.banks.idPrefix"),": ",o.id]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{to:`/admin/question-banks/${o.id}`,children:e.jsx(j,{variant:"primary",children:s("admin.banks.editButton")})}),e.jsx(j,{onClick:()=>r(o),variant:"danger",children:s("admin.banks.deleteButton")})]})]},o.id))})]})}),e.jsx(M,{isOpen:a,onClose:f,onConfirm:b,title:s("admin.banks.modal.title"),message:d?s("admin.banks.modal.message",{name:d.name||s("admin.banks.untitled"),count:k[d.id]||0}):"",confirmText:s("admin.banks.modal.confirmText"),confirmVariant:"danger"})]})}export{U as default};
